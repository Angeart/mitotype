<!DOCTYPE html>
<html lang="ja">
<!-- 
                                                                               ■      
  ■■         ■■■■■     ■■■■■      ■■           ■            ■                  ■      
  ■■   ■                  ■        ■   ■    ■■■■■■■    ■■■■■■■■■   ■■■■■■      ■ ■■■  
■■■■■■ ■       ■■        ■■  ■     ■ ■■■      ■             ■                ■■■■■ ■■ 
  ■  ■ ■■   ■■■■■■      ■■■  ■     ■■■       ■■■■ ■■      ■■■                  ■■  ■■ 
  ■  ■  ■      ■■     ■■■■■■■■     ■■       ■■  ■■■      ■  ■                 ■■   ■■ 
 ■■  ■  ■     ■■      ■ ■■  ■■■   ■■        ■  ■■■       ■  ■      ■         ■■■   ■  
 ■   ■       ■■■      ■ ■   ■■■   ■           ■ ■■        ■■■      ■         ■■■   ■  
■■   ■      ■■ ■■     ■■   ■■     ■■          ■            ■■      ■         ■ ■   ■ ■
■  ■■      ■■   ■■■■      ■■       ■■■■■■     ■■■■■■     ■■■        ■■■■■■     ■   ■■■
 -->

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/siimple@3.0.0/dist/siimple.min.css">
    <link rel="stylesheet" href="./css/modaal.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="hash" content="みとたいぴんぐ">
    <meta name="hash" content="月ノ美兎">
    <title>みとたいぴんぐ</title>
</head>
<style>
    html {
        font-size: calc(100vw / 100);
    }

    .trans,
    .trans * {
        transition-duration: 0.6s;
    }

    body {
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background-image: url(./img/mito01.jpg);
        background-blend-mode: screen;
        background-color: #888;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }

    .input {
        margin: auto;
        opacity: 0;
    }

    .wait_screen {
        opacity: 0;
        position: absolute;
        width: 100vw;
        height: 100vh;
        z-index: -1;
        background-color: rgba(0, 0, 0, 0.3);
    }

    .state_2 .input,
    .state_3 .input {
        opacity: 1 !important;
    }

    .state_0 .start {
        opacity: 1;
        z-index: 100;
    }

    .state_1 .wait_screen {
        opacity: 1;
        z-index: 100;
    }

    .state_4 .result {
        opacity: 1;
        z-index: 100;
    }

    .input {
        z-index: -1;
        text-align: center;
    }

    .input>#main {
        width: 20vw;
        height: 4vh;
        left: 50%;
        position: relative;
        transform: translateX(-50%);
    }

    .timer>p {
        text-align: center;
        font-size: 4rem;
        margin-top: 0px;
        margin-bottom: 0.2rem;
        color: #ff91dc;
    }

    .score p {
        text-align: center;
        font-size: 2rem;
        margin-top: 0px;
    }

    .mondai>div {
        display: inline-block;
        left: 50%;
        position: relative;
        transform: translateX(-50%);
    }

    .mondai p {
        text-align: center;
        font-size: 5rem;
        display: inline-block;
        margin-top: 0px;
        margin-bottom: 0.2rem;
        white-space: pre;
    }

    .mondai .done {
        color: #77d433;
    }

    .start {
        margin: 0;
        text-align: center;
        width: 100%;
        position: absolute;
        opacity: 0;
    }

    .start p.anim {
        font-size: 4rem;
        animation-name: start;
        animation-duration: 3s;
        animation-iteration-count: infinite;
    }

    @keyframes start {
        0% {
            font-size: 4rem;
        }
        50% {
            font-size: 3.9rem;
        }
        100% {
            font-size: 4rem;
        }
    }

    .count_down {
        margin: auto;
        display: inline-block;
        position: absolute;
        transform: translate(-50%, -50%);
        left: 50%;
        top: 50%;
    }

    .count_down p {
        color: #fff;
        font-size: 7rem;
        margin: 0px;
    }

    .result {
        opacity: 0;
        position: absolute;
        width: 100vw;
        height: 100vh;
    }

    .result>div {
        top: 50%;
        transform: translateY(-50%);
        position: relative;
    }

    .result .score_result>p {
        text-align: center;
        margin-top: 0px;
        font-size: 4rem;
    }

    .score_result p::before {
        content: 'score : ';
    }

    .trophy p::before {
        content: '称号 ';
    }

    .trophy p {
        text-align: center;
        font-size: 2rem;
    }

    .msg p {
        text-align: center;
        font-size: 1rem;
    }

    #title {
        font-size: 10rem;
        margin-bottom: -0.5rem;
    }

    .invisible {
        position: absolute;
        display: none;
    }

    #tweet {
        display: inline-block;
        left: 50%;
        position: relative;
        transform: translateX(-50%);
    }

    .tweet-share-custom {
        height: 32px;
        width: 32px;
        display: block;
        background-image: url(./img/twitter_icon.png);
        background-size: contain;
        background-repeat: no-repeat;
        margin: calc(32px * 0.25);
    }

    p.break {
        word-break: break-all;
        max-width: 100vw;
        white-space: normal;
        display: inline;
    }

    .small {
        font-size: 1.5rem;
    }

    span#erufu {
        background-image: url("./img/mori.png");
        width: 48px;
        height: 48px;
        display: inline-block;
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
    }

    span.mori {
        background-image: url("./img/moyasuze.png");
        display: inline-block;
        width: 64px;
        height: 64px;
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
    }

    div#rank {
        display: inline-block;
    }

    div#uzai {
        background-image: url("./img/mito.png");
        display: inline-block;
        width: 200px;
        height: 200px;
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
        position: absolute;
        top: 0px;
        left: 0px;
    }

    #option_modal {
        display: none;
    }

    .toggle-buttons {
        display: flex;
    }

    .toggle-buttons.vertical {
        flex-direction: column;
    }

    .toggle-buttons label {
        display: flex;
        position: relative;
    }

    .toggle-buttons [type=radio],
    .toggle-buttons [type=checkbox] {
        -webkit-appearance: none;
        -moz-appearance: none;
        position: absolute;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
    }

    /* appearance: none; for IE11 */

    _:-ms-lang(x)::-ms-backdrop,
    .toggle-buttons [type=radio],
    _:-ms-lang(x)::-ms-backdrop,
    .toggle-buttons [type=checkbox] {
        visibility: hidden;
    }

    .toggle-buttons * {
        transition-duration: 0.5s;
        transition-property: opacity, color, background-color, border-color;
    }

    .toggle-buttons .button {
        z-index: 1;
    }

    .toggle-buttons.vertical .button {
        width: 100%;
    }

    .toggle-buttons:not(.vertical) :not(:first-child) .button {
        border-left: 0px;
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }

    .toggle-buttons:not(.vertical) :not(:last-child) .button {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
        border-right: 0px;
    }

    .toggle-buttons.vertical :not(:first-child) .button {
        border-top: 0px;
        border-top-left-radius: 0;
        border-top-right-radius: 0;
    }

    .toggle-buttons.vertical :not(:last-child) .button {
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
    }

    .toggle-buttons :checked+.button {
        background-color: #345;
        border: solid 1px #345;
        color: #fff;
    }

    .toggle-buttons :disabled+.button {
        cursor: not-allowed;
        opacity: .6;
        color: #def;
    }

    .toggle-buttons input {
        outline: none;
    }

    .button {
        display: inline-block;
        padding: .5rem 1rem;
        border-radius: 4px;
        text-align: center;
        color: #abb;
        background-color: transparent;
        cursor: pointer;
        border: solid 1px #abb;
        min-width: 4rem;
    }

    .button:hover {
        background-color: #567;
        border: solid 1px #567;
        color: #fff
    }

    .button:disabled {
        cursor: not-allowed;
        opacity: .6;
        color: #def;
    }

    .flex_center {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .flex_right {
        display: flex;
        justify-content: flex-end;
        align-content: center;
    }

    .flex_between {
        display: flex;
        justify-content: space-between;
        align-content: center;
    }

    .flex_around {
        display: flex;
        justify-content: space-around;
        align-content: center;
        flex-wrap: wrap;
    }

    .flex_around>div {
        width: calc(100% / 4);
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 0.1rem;
    }

    .jisseki {
        display: inline-block;
    }

    .siimple-btn {
        font-size: 1rem;
        line-height: 2rem;
        height: 2rem;
    }
</style>

<body class="state_0" oncontextmenu="return false;">
    <div id="option_modal">
        <div class="flex_around">
            <div>し</div>
            <div>
                <div class="toggle-buttons">
                    <label>
                        <input type="radio" name="si_or_shi" checked>
                        <span class="button">shi</span>
                    </label>
                    <label>
                        <input type="radio" name="si_or_shi">
                        <span class="button">si</span>
                    </label>
                </div>
            </div>
            <div>じ</div>
            <div>
                <div class="toggle-buttons">
                    <label>
                        <input type="radio" name="zi_or_ji" checked>
                        <span class="button">zi</span>
                    </label>
                    <label>
                        <input type="radio" name="zi_or_ji">
                        <span class="button">ji</span>
                    </label>
                </div>
            </div>
            <div>ち</div>
            <div>
                <div class="toggle-buttons">
                    <label>
                        <input type="radio" name="ti_or_chi" checked>
                        <span class="button">ti</span>
                    </label>
                    <label>
                        <input type="radio" name="ti_or_chi">
                        <span class="button">chi</span>
                    </label>
                </div>
            </div>
            <div>しゃ</div>
            <div>
                <div class="toggle-buttons">
                    <label>
                        <input type="radio" name="sya_or_sha" checked>
                        <span class="button">sya</span>
                    </label>
                    <label>
                        <input type="radio" name="sya_or_sha">
                        <span class="button">sha</span>
                    </label>
                </div>
            </div>
            <div>つ</div>
            <div>
                <div class="toggle-buttons">
                    <label>
                        <input type="radio" name="tu_or_tsu" checked>
                        <span class="button">tu</span>
                    </label>
                    <label>
                        <input type="radio" name="tu_or_tsu">
                        <span class="button">tsu</span>
                    </label>
                </div>
            </div>
            <div>しゅ</div>
            <div>
                <div class="toggle-buttons">
                    <label>
                        <input type="radio" name="syu_or_shu" checked>
                        <span class="button">syu</span>
                    </label>
                    <label>
                        <input type="radio" name="syu_or_shu">
                        <span class="button">shu</span>
                    </label>
                </div>
            </div>
            <div>ふ</div>
            <div>
                <div class="toggle-buttons">
                    <label>
                        <input type="radio" name="fu_or_hu" checked>
                        <span class="button">fu</span>
                    </label>
                    <label>
                        <input type="radio" name="fu_or_hu">
                        <span class="button">hu</span>
                    </label>
                </div>
            </div>
            <div>しぇ</div>
            <div>
                <div class="toggle-buttons">
                    <label>
                        <input type="radio" name="sye_or_she" checked>
                        <span class="button">sye</span>
                    </label>
                    <label>
                        <input type="radio" name="sye_or_she">
                        <span class="button">she</span>
                    </label>
                </div>
            </div>
            <div>ん</div>
            <div>
                <div class="toggle-buttons">
                    <label>
                        <input type="radio" name="n_or_nn" checked>
                        <span class="button">n</span>
                    </label>
                    <label>
                        <input type="radio" name="n_or_nn">
                        <span class="button">nn</span>
                    </label>
                </div>
            </div>
            <div>しょ</div>
            <div>
                <div class="toggle-buttons">
                    <label>
                        <input type="radio" name="syo_or_sho" checked>
                        <span class="button">syo</span>
                    </label>
                    <label>
                        <input type="radio" name="syo_or_sho">
                        <span class="button">sho</span>
                    </label>
                </div>
            </div>
            <div>ぁ</div>
            <div>
                <div class="toggle-buttons">
                    <label>
                        <input type="radio" name="xa_or_la" checked>
                        <span class="button">xa</span>
                    </label>
                    <label>
                        <input type="radio" name="xa_or_la">
                        <span class="button">la</span>
                    </label>
                </div>
            </div>
            <div>じゃ</div>
            <div>
                <div class="toggle-buttons">
                    <label>
                        <input type="radio" name="zya_or_jya_ja" checked>
                        <span class="button">zya</span>
                    </label>
                    <label>
                        <input type="radio" name="zya_or_jya_ja">
                        <span class="button">jya</span>
                    </label>
                    <label>
                        <input type="radio" name="zya_or_jya_ja">
                        <span class="button">ja</span>
                    </label>
                </div>
            </div>
        </div>
    </div>
    <div class="start trans">
        <p id="title">みとたいぴんぐ</p>
        <p class="small">chrome 推奨！！</p>
        <p class="anim trans">Enter で start</p>
        <div href="#option_modal" id="open_option" class="siimple-btn siimple-btn--navy">オプション</div>
    </div>
    <div class="wait_screen trans">
        <div class="count_down">
            <p></p>
        </div>
    </div>
    <div class="result trans">
        <div>
            <div class="score_result">
                <p>999999</p>
            </div>
            <div class="trophy">
                <p>クソザコムカデ</p>
            </div>
            <div class="msg">
                <p>Enter で 最初に戻る</p>
                <div id="tweet">
                    <a href="http://twitter.com/share" data-text="" class="tweet-share-custom"></a>
                </div>
                <p>
                    <a href="https://twitter.com/shinomiya_ag">@shinomiya_ag</a>
                </p>
            </div>
        </div>
    </div>
    <div class="input trans">
        <div class="timer">
            <p>99</p>
        </div>
        <div class="score">
            <p>0</p>
        </div>
        <div class="jisseki">
            <span id="erufu"></span>
            <div id="rank">
                <span class="mori"></span>
            </div>
        </div>
        <div class="mondai">
            <div>
                <p class="done"></p>
                <p class="wait">monndai</p>
            </div>
        </div>
        <div id="uzai" class="trans"></div>
        <input type="button" class="invisible">
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.4/TweenMax.min.js" crossorigin="anonymous"></script>
    <script>
        $('.invisible').trigger("click");
    </script>
    <script src="./js/ion.sound.js"></script>
    <script src="./js/modaal.min.js"></script>
    <script>
        $('#open_option').modaal();
        let text_data = [
            { name: "3分とは言わず今死ね", data: "3huntoha iwazu imashine" },
            { name: "BAN", data: "ban" },
            { name: "BBS", data: "bbs" },
            { name: "linenews", data: "line news", noregex: true },
            { name: "men is forest women is river", data: "men is forest. woman is river.", noregex: true },
            { name: "oldold", data: "old old" },
            { name: "thatplace", data: "that place", noregex: true },
            { name: "X8", data: " xxxxxxxx" },
            { name: "あっふーん", data: "a...fuuun" },
            { name: "アナログ炬燵", data: "anarogugotatsu" },
            { name: "アナログ炬燵2", data: "anarogugotatsu" },
            { name: "あらまぁ", data: "aramala" },
            { name: "イキリト", data: "ore su ga ikebo dakarasa ichiou otaku dakedo kanojo irushi orette hikenai seikakudashi sokorahentoka meccha niterutte iwareru akuryokumo 31kiro atte kurasu no joshi ni takarareru kanojo irukara yamero ore koredemo chuuichi desuyo kanojo ha asuna ni desu (kiitenele)" },
            { name: "えやってないですよあたくし", data: "e, yattenaidesuyo atakushi" },
            { name: "おっなんだ？ファックだと？", data: "oltunanda? fuck dato?" },
            { name: "おるやんけおるやんけどなたかおるやんけ", data: "oruyanke oruyanke donatakaoruyanke" },
            { name: "クソゲー乙", data: "kusoge-otsu" },
            { name: "クソザコイングリッシュ", data: "kusozako english" },
            { name: "クソザコパンチやめてください", data: "kusozako panchi yametekudasai" },
            { name: "グルシャン", data: "gurusyan" },
            { name: "クローバー", data: "kuro-ba-" },
            { name: "コココココン", data: "kokokokokokonn" },
            { name: "これがVirtualYoutuberなんだよなぁ", data: "korega virtual youtuber nandayonaa..." },
            { name: "スッペラピッチョン2", data: "supperapicchon" },
            { name: "っく", data: "kku" },
            { name: "トレーディングカードゲーム", data: "tore-delingu ka-doge-mu" },
            { name: "ネズミの死骸", data: "nezumi no shigai" },
            { name: "パンツマンさん", data: "pantsuman san" },
            { name: "ふざけんなおまえ", data: "huzakennna omae" },
            { name: "ヘテロヘテロ", data: "hetero hetero" },
            { name: "ムカデ人間2", data: "mukadeningen" },
            { name: "もみじ", data: "momiji" },
            { name: "わたくし2", data: "watakushi" },
            { name: "わたくしで隠さなきゃ", data: "watakushide kakusanakya" },
            { name: "覚せい剤を追放しよう", data: "kakuseizai wo tsuihoushiyou" },
            { name: "許さねぇからなお前", data: "yurusanelekarana omae" },
            { name: "緊急事態", data: "kinkyuujitai" },
            { name: "愚の直行", data: "guno chokkou" },
            { name: "警察舐めとんちゃうぞこら", data: "keisatsu nametonchauzo kora" },
            { name: "血吐き少女", data: "chi hakisyoujo" },
            { name: "校庭に生えてる草のコンプ", data: "kouteini haeteru kusanokonpu" },
            { name: "砂糖卵小麦粉", data: "satou tamago komugiko" },
            { name: "雑草", data: "zassou" },
            { name: "三角関係", data: "sankakukankei" },
            { name: "死んだ胎児", data: "shinda taiji" },
            { name: "実質会食", data: "jisshitsu kaisyoku" },
            { name: "酒井ぃ？名前覚えたからなぁ", data: "sakai? namaeoboetakarana..." },
            { name: "親友が教室でウンコ漏らしたら自分もウンコ漏らすべきなんですよ", data: "shinyuuga kyoushitsude unko morashitara jibunmo unko morasubeki nandesuyo" },
            { name: "川の中の石を割る", data: "kawa no nakano ishi wo waru" },
            { name: "洗濯機2", data: "sentaki" },
            { name: "中腰", data: "chuugoshi" },
            { name: "頭脳明晰容姿端麗ポケモンマスター", data: "zunoumeiseki youshitanrei pokemonmasuta-" },
            { name: "彼とチューしたいって思っちゃんたんですよねわたくし", data: "kareto chu-shitaitte omocchattandesuyone watakushi" },
            //{ name: "ルイズコピペ", data: "ruizu ruizu ruizu ruizu he uwaaaaaaaaaa ltu guwaa aaaaaa ruizu ruizu ruizu ruizu nuwaaahhahhahaaaa ala kunka kunka kunka kunka su-ha-su-ha- su-ha-su-ha- iinioi danala kunkun nnleahhaa ruizu furansowa tan no momoiro burondo no kami wo kunka kunka shitaiyo kunka kunka alaltu... a e tyotto matte machigaeta! mohumohu shitaiyo mohumohu mohumohu kamikamimohumohu karikarimohumohu kyunkyunkyun shousetsu 12kan no ruizu tan kawaikatta yo ala a ala uwaaaa manime 2ki housou sarete yokattayo ruizu tan alaltsu kawaii ruizu tan kawaii altu alaa komikku 2kan mo hatsubai sarete ureshiiii iyaaaaa nyaaan kyaaaaa kuwaaaaaa komikku nante genjitu janai altu shousetsu mo anime moyoku kangaetara ruizu chan ha genjitsu janai nyaaaaann nnwaaaaaaaa ahahaha sonnaaa iyaa aaha ha sonnaa harugenyaaa konna chikushoume yameteyaru genjitsu nante yame... mite...ru? hyoushie no ruizu chan ga bokuwo miteru... hyoushie no ruizu chan ga boku wo miteruzo! ruizu chan ga boku wo miteruzo sashie no ruizu chan ga boku wo miteru zo anime no ruizu chan ga bokuni hanashikaketeruzo yokattala yononaka madamada sutema sutetamonjanaine iyahhooooo! boku niha ruizu chan ga iru yattayo kethi hitori de dekiru mon! altu komikku noruizu chan iyaaaahahahaaaan ansama shi shiesuta anrietta tabasa uultu nnnn oreno omoiyo ruizu ni todoke harugenia no ruizu he todoke"},
        ];
        let base_sounds = [
            { name: "snap" },
            { name: "door_bell" },
            { name: "correct2" },
            { name: "incorrect1" },
            { name: "people_people-stadium-applause1" },
        ];
        $.ionSound({
            sounds: base_sounds.concat(text_data.map((v) => { return { name: v.name }; })),
            path: "sounds/",
            preload: true,
            multiplay: true,
            volume: 0.9
        });

        var perlin = (() => {
            function noise(x) {
                x = (x << 13) ^ x;
                return (1 - ((x * (x * x * 15731 + 789221) + 1376312589) & 0x7fffffff) / 1073741824);
            }

            function smooth_noise(x) {
                return noise(x) * 0.5 + noise(x - 1) * 0.25 + noise(x + 1) * 0.25;
            }

            function cos_interpolate(a, b, x) {
                let ft = x * Math.PI;
                let f = (1 - Math.cos(ft)) * 0.5;
                return a * (1 - f) + b * f;
            }

            function interpolated_noise(x) {
                let int_x = Math.floor(x);
                let fractional_x = x - int_x;
                let v1 = smooth_noise(int_x);
                let v2 = smooth_noise(int_x + 1);
                return cos_interpolate(v1, v2, fractional_x);
            }

            function perlin(x) {
                let total = 0;
                let p = 1 / 4;
                for (var i = 0; i < 6; ++i) {
                    let freq = Math.pow(2, i);
                    let amp = Math.pow(p, i);
                    total += interpolated_noise(x * freq) * amp;
                }
                return total;
            }
            return perlin;
        })();

        var MutekiTimer = (function () {
            var MutekiTimer = function () {
                initialize.apply(this, arguments);
            }, $this = MutekiTimer.prototype;

            var TIMER_PATH = (function () {
                var BlobBuilder, URL, builder;
                BlobBuilder = self.WebKitBlobBuilder || self.MozBlobBuilder;
                URL = self.URL || self.webkitURL;
                if (BlobBuilder && URL) {
                    builder = new BlobBuilder();
                    builder.append("var timerId = 0;");
                    builder.append("this.onmessage = function(e) {");
                    builder.append("  if (timerId !== 0) {");
                    builder.append("    clearInterval(timerId);");
                    builder.append("    timerId = 0;");
                    builder.append("  }");
                    builder.append("  if (e.data > 0) {");
                    builder.append("    timerId = setInterval(function() {");
                    builder.append("        postMessage(null);");
                    builder.append("    }, e.data);");
                    builder.append("  }");
                    builder.append("};");
                    return URL.createObjectURL(builder.getBlob());
                }
                return null;
            }());

            var initialize = function () {
                if (TIMER_PATH) {
                    this._timer = new Worker(TIMER_PATH);
                    this.isMuteki = true;
                } else {
                    this._timer = null;
                    this.isMuteki = false;
                }

                this._timerId = 0;
            };

            $this.setInterval = function (func, interval) {
                if (this._timer !== null) {
                    this._timer.onmessage = func;
                    this._timer.postMessage(interval);
                } else {
                    if (this._timerId !== 0) {
                        clearInterval(this._timerId);
                    }
                    this._timerId = setInterval(func, interval);
                }
            };

            $this.clearInterval = function () {
                if (this._timer !== null) {
                    this._timer.postMessage(0);
                } else if (this._timerId !== 0) {
                    clearInterval(this._timerId);
                    this._timerId = 0;
                }
            };

            return MutekiTimer;
        }());

        function shuffle(array) {
            var n = array.length, t, i;

            while (n) {
                i = Math.floor(Math.random() * n--);
                t = array[n];
                array[n] = array[i];
                array[i] = t;
            }

            return array;
        }
        const pixel_per_em = Number(getComputedStyle(document.body, null).fontSize.replace(/[^\d]/g, ''));

        function char_count(str) {
            let len = 0;
            str = escape(str);
            for (let i = 0; i < str.length; i++ , len++) {
                if (str.charAt(i) == "%") {
                    if (str.charAt(++i) == "u") {
                        i += 3;
                        len++;
                    }
                    i++;
                }
            }
            return len;
        }

        function str_pixel(str) {
            return char_count(str) * pixel_per_em
        }


        let state = 0;

        (() => {
            let remain_default = 99;
            let remain = remain_default;
            let trophies = [
                , '3分と言わず今死ね'
                , 'クソザコナメクジ'
                , 'サブカルクソムカデ'
                , '血糊クッキー'
                , 'もみじ'
                , 'クソザコパンチ'
                , '七草'
                , 'ゴリラ'
                , '洗濯機'
                , 'カブトガニ'
                , '血吐き少女'
                , 'ムカデ人間'
                , '赤子の拳'
                , 'みょうが'
                , '中腰委員長'
                , '納豆'
                , 'ヘテロヘテロ'
                , 'クローバー'
                , 'もやすぜ'
                , '清楚(Vtuber)'
                , '雑草コンプ'
                , '清純系委員長'
                , '頭脳明晰容姿端麗ポケモンマスター'
                , 'これがバーチャルYouTuberなんだよなぁ…'
                , 'かえみとを末永くよろしくお願いします'
            ]
            let max = 1000 * 10;
            let max_score = max * text_data.length * 0.6;
            let current = 0;
            let time = 0;
            let score = 0;
            let first = true;
            let count_down = 3;
            let count_down_handle = undefined;
            let score_wait = false;
            let miss_count = 0;
            let require_l2x = false;
            $('body').on('keypress', function (e) {
                var charCode = (typeof e.which == "number") ? e.which : e.keyCode;
                switch (state) {
                    case 0:
                        // title
                        {
                            if (charCode == 13) {
                                status_change(() => {
                                    $('.count_down p').text(count_down);
                                    count_down_handle = new MutekiTimer();
                                    count_down_handle.setInterval(() => {
                                        --count_down;
                                        if (count_down == 0) {
                                            count_down = 3;
                                            status_change();
                                            count_down_handle.clearInterval();
                                            start();
                                            return;
                                        }
                                        $('.count_down p').text(count_down);
                                    }, 1000);
                                    clear();
                                });
                            }
                        }
                        break;
                    case 1:
                        // wait
                        break;
                    case 2:
                        // start
                        {
                            let input_data = $('.wait');
                            let c = input_data.text().substr(0, 1);
                            let val = c.charCodeAt(0);
                            let done = $('.done');
                            if (c == ' ') {
                                done.text(done.text() + c);
                                input_data.text(input_data.text().slice(1));
                                c = input_data.text().substr(0, 1);
                                val = c.charCodeAt(0);
                            }
                            if (String.fromCharCode(charCode).localeCompare(c, "en", { sensitivity: "base" }) == 0) {
                                $.ionSound.play("snap");
                                input_data.text(input_data.text().slice(1));
                                done.text(done.text() + c);
                                if (input_data.text().length == 0) {
                                    ++current;
                                    $.ionSound.play("correct2");
                                    score_calc();
                                    set();
                                    $("#rank").append($("<span>").addClass("mori"));
                                }
                            } else {
                                ++miss_count;
                                $.ionSound.play("incorrect1");
                            }
                        }
                        break;
                    case 3:
                        // wait end
                        break;
                    case 4:
                        {
                            if (charCode == 13)
                                status_change(undefined, 0);
                        }
                        // result
                        break;
                };
            });
            function status_change(cb, val) {
                ++state;
                if (val != undefined && val == 0) state = val;
                $('body').removeClass().addClass('state_' + state);
                if (cb) {
                    cb();
                }
            }
            function score_calc() {
                let cof = (max - time) < 0 ? 0 : (max - time);
                cof -= (cof % 10);
                let max_miss = 20;
                let rate = (miss_count / max_miss);
                if (rate >= 1) rate = 1;
                rate = 1 - rate;
                cof *= rate;
                cof *= $('.done').text().length / 15;
                cof = Math.round(cof);
                score += cof;
                time = 0;
                miss_count = 0;
            }
            function set() {
                if (current >= text_data.length) {
                    text_data = shuffle(text_data);
                    current = 0;
                }
                $('.done').text('').removeClass('break');
                let text = text_data[current].data;
                if (require_l2x && text_data[current].noregex === undefined) {
                    text = text.replace(/l([aiueot])/g, "x$1");
                }
                $('.wait').text(text).removeClass('break');
                $.ionSound.play(text_data[current].name);
                if (Math.max(str_pixel(text), $('.wait').width()) > window.innerWidth) {
                    $('.done').addClass('break');
                    $('.wait').addClass('break');
                }
            };
            function clear() {
                remain = remain_default;
                current = 0;
                time = 0;
                score = 0;
                miss_count = 0;
                $("#rank").empty()
            }
            function set_result() {
                $('.result .score_result p').text(score);
                let selector = Math.floor((score / max_score) * trophies.length * 1.1);
                if (selector > trophies.length) selector = trophies.length - 1;
                $('.result .trophy p').text(trophies[selector]);
            }
            $('.tweet-share-custom').on('click', function (event) {
                event.preventDefault();
                var href = $(this).attr('href');
                href += '?url=' + escape(location.origin + location.pathname);
                var text = "score : " + $('.result .score_result p').text() + " - " + $('.result .trophy p').text();
                href += '&text=' + text;
                var hashs = $('meta[name=hash]');
                let hash_data = "";
                for (var hash of hashs) {
                    hash_data += $(hash).attr('content') + ",";
                }
                if (hash_data != "") href += '&hashtags=' + hash_data;
                var left = (window.screen.width - 550) * 0.5;
                var top = (window.screen.height - 420) * 0.5;
                window.open(href, '_blank', 'left=' + left + ', top=' + top + ', toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=yes, width=' + 550 + ', height=' + 420);
            });
            function start() {
                text_data = shuffle(text_data);
                require_l2x = ($('select').val() == "小文字x派");
                clear();
                set();
                if (!first) return;
                first = true;

                let remain_timer = new MutekiTimer();
                let score_time_timer = new MutekiTimer();
                let count_up_timer = new MutekiTimer();
                let mitotimer = new MutekiTimer();
                mitotimer.setInterval((() => {
                    var date = new Date();
                    var rand = (min, max) => { return Math.random() * (max - min) + min; };
                    var sx = Math.floor(date.getTime() * 0.0001) * rand(1, 13);
                    var sy = Math.floor(date.getTime() * 0.0001) * rand(1, 13);
                    var x = 0;
                    var y = 0;
                    var fx = 1;
                    var fy = 1;
                    var imgw = $('#uzai').width();
                    var imgh = $('#uzai').height();
                    return () => {
                        if (document.hidden) return;
                        var vx = perlin(++sx) * 10;
                        var vy = perlin(++sy) * 10;
                        if ((x + vx * fx + imgw) > window.innerWidth || (x + vx * fx) < 0) {
                            fx *= -1;
                        }
                        if ((y + vy * fy + imgh) > window.innerHeight || (y + vy * fy) < 0) {
                            fy *= -1;
                        }
                        x += vx * fx;
                        y += vy * fy;
                        $('#uzai').css('transform', 'translate(' + x + 'px,' + y + 'px)');
                    };
                })(), 100);
                function clear_count_up_timer() {
                    if (state == 3) {
                        count_up_timer.clearInterval();
                        status_change();
                        set_result();
                    }
                }
                remain_timer.setInterval(() => {
                    --remain;
                    $('.timer > p').text(remain);
                    if (remain == 0) {
                        remain_timer.clearInterval();
                        score_time_timer.clearInterval();
                        mitotimer.clearInterval();
                        status_change(clear_count_up_timer);
                    }
                }, 1000);
                score_time_timer.setInterval(() => {
                    ++time;
                }, 1);
                count_up_timer.setInterval(() => {
                    let crr = parseInt($('.score p').text());
                    crr += 100;
                    score_wait = true;
                    if (crr >= score) {
                        crr = score;
                        score_wait = false;
                        if (state == 3)
                            clear_count_up_timer();
                    }
                    $('.score p').text(crr);
                }, 10);
            }
        })();
    </script>
</body>

</html>